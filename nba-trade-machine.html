<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>NBA Trade Machine</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #f6f8fa;
      margin: 0;
      color: #23272F;
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(22,30,45,0.33);
      z-index: 2222;
      display: none;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s;
    }
    .modal-overlay.active { display: flex; }
    .trade-modal {
      background: #fff;
      border-radius: 18px;
      padding: 2.5rem 2.2rem;
      max-width: 460px;
      box-shadow: 0 8px 48px rgba(10,23,78,0.23);
      text-align: center;
      position: relative;
      animation: scaleIn 0.22s;
      min-width: 310px;
    }
    @keyframes scaleIn {
      from { transform: scale(0.86); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to   { opacity: 1;}
    }
    .modal-close-btn {
      position: absolute; top: 1.1rem; right: 1.5rem;
      font-size: 2rem;
      color: #0057e7;
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.15s;
    }
    .modal-close-btn:hover { opacity: 1; }
    .modal-title-success {
      color: #22a96e;
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 1.6rem;
    }
    .modal-title-fail {
      color: #d42c2c;
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 1.6rem;
    }
    .modal-section {
      text-align: left;
      padding: 1rem 0 0.3rem 0;
      margin-bottom: 0.8rem;
    }
    .modal-section label {
      font-weight: bold;
      color: #0057e7;
      margin-bottom: 0.2rem;
      display: block;
    }
    .modal-player-group {
      margin-bottom: 0.7rem;
    }
    .modal-player-list {
      margin: 0 0 0.6rem 0; padding: 0; list-style: none;
      display: flex; flex-wrap: wrap; gap: 0.6rem;
    }
    .modal-player-list li {
      background: #f0f5fd;
      border-radius: 6px;
      padding: 0.4em 0.85em;
      font-weight: 600;
      color: #23272f;
      font-size: 1.1rem;
      box-shadow: 0 1px 5px rgba(10,23,78,0.06);
      display: flex; align-items: center;
      gap: 0.6em;
    }
    .modal-team-label {
      font-size: 1.1em;
      font-weight: bold;
      color: #0057e7;
      margin-bottom: 0.3em;
      margin-top: 0.7em;
      display: block;
    }
    .modal-fail-reason {
      color: #d42c2c;
      font-weight: 600;
      font-size: 1.13rem;
      padding: 1rem 0 0.5rem 0;
      line-height: 1.5;
    }

    /* --- Modernized Team Header --- */
    .team-header {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      background: linear-gradient(90deg, #0057e7 60%, #2688ff 100%);
      border-radius: 100px;
      box-shadow: 0 2px 15px rgba(0,87,231,0.12);
      padding: 0.85rem 1.4rem;
      margin-bottom: 1.1rem;
      min-height: 55px;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
      position: relative;
    }
    .team-label {
      color: #fff;
      font-weight: 700;
      font-size: 1.18rem;
      margin-right: 0.8rem;
      letter-spacing: 0.02em;
      text-shadow: 0 2px 6px rgba(10,23,78,0.09);
    }
    .team-header select {
      font-size: 1.13rem;
      border-radius: 9px;
      border: none;
      padding: 0.45rem 1.5rem;
      font-weight: 600;
      background: #ecf3fb;
      color: #0a174e;
      box-shadow: 0 2px 9px rgba(10,23,78,0.06);
      transition: background 0.14s;
      outline: none;
    }
    .remove-team-btn {
      background: none;
      color: #fff;
      border: none;
      font-size: 1.55rem;
      font-weight: bold;
      cursor: pointer;
      margin-left: auto;
      margin-right: -0.4rem;
      transition: color 0.18s;
      box-shadow: none;
      padding: 0;
      opacity: 0.85;
      position: absolute;
      right: 16px;
      top: 10px;
    }
    .remove-team-btn:hover { color: #ffc2c2; }

    /* --- All Players visible --- */
    .players-list {
      max-height: unset !important; /* show all players */
      overflow-y: visible !important;
      gap: 0.65rem !important;
    }

    /* --- NavBar Modernization for Desktop --- */
    .navbar {
      border-bottom: 2px solid #18307c;
      padding: 0.5rem 3.5vw !important;
      min-height: 64px;
      box-shadow: 0 2px 18px rgba(10,23,78,0.09);
      font-size: 1.12rem;
    }
    .nav-left { gap: 1.22rem; }
    .nav-right {
      gap: 2.5rem;
      margin-right: 1vw;
      font-size: 1.13em;
    }
    .nav-link, .dropdown-btn {
      font-size: 1.08em;
      padding: 0.67em 1.4em;
      border-radius: 7px;
      margin: 0 0.2em;
      font-weight: 600;
      background: transparent;
      border: none;
      outline: none;
      transition: background 0.18s, color 0.18s, box-shadow 0.13s;
    }
    .nav-link:hover, .dropdown-btn:hover, .nav-link.active {
      background: linear-gradient(90deg,#0057e7 60%,#2688ff 100%);
      color: #fff !important;
      box-shadow: 0 3px 12px rgba(0,87,231,0.10);
    }
    .dropdown-content {
      left: 50%;
      transform: translateX(-50%);
      min-width: 235px;
      font-size: 1.07em;
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(10,23,78,0.13);
    }
    @media (min-width: 1400px) {
      .navbar { padding-left: 7vw!important; padding-right: 7vw!important;}
      .nav-right { margin-right: 4vw;}
    }
    @media (max-width: 900px) {
      .navbar { padding-left: 0.9rem!important; padding-right: 0.9rem!important;}
      .nav-right { gap: 1.1rem;}
    }
    @media (max-width: 600px) {
      .navbar { font-size: 1em;}
      .nav-right { gap: 0.5rem;}
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <img src="sixershoopslogo.png" alt="SixersHoops Logo" class="nav-logo" />
      <span class="site-title">SixersHoops</span>
    </div>
    <button class="hamburger" aria-label="Menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="nav-right">
      <a href="index.html" class="nav-link">Home</a>
      <div class="nav-dropdown">
        <button class="dropdown-btn" aria-haspopup="true" aria-expanded="false">Cap &amp; Draft Management</button>
        <div class="dropdown-content">
          <a href="salary.html" class="dropdown-link">Salary Breakdown</a>
          <a href="draft.html" class="dropdown-link">Future Draft Capital</a>
          <a href="depth.html" class="dropdown-link">Depth Chart</a>
        </div>
      </div>
      <a href="nba-trade-machine.html" class="nav-link active">Trade Machine</a>
    </div>
  </nav>
  <div style="height:70px"></div>
  <h1>NBA Trade Machine</h1>
  <div class="description-block">
    <strong>About the Trade Machine:</strong> This NBA Trade Machine lets you simulate up to 5-team trades under the 2025 CBA rules.<br>
    <strong>Note:</strong> This tool doesn't include salary bonuses or incentives, so numbers may be slightly off from actual cap sheets.<br><br>
    <b>Aprons?</b> Salary thresholds above the cap that trigger extra restrictions:<br>
    <span style="color:#0057e7;font-weight:600;">Salary Cap:</span> $154.647M &nbsp; <span style="color:#b91c1c;font-weight:600;">Luxury Tax:</span> $187.895M &nbsp;
    <span style="color:#15803d;font-weight:600;">First Apron:</span> $195.945M &nbsp; <span style="color:#2c2c2c;font-weight:600;">Second Apron:</span> $207.824M
    <ul>
      <li><b>1st Apron:</b> Can only take back the greater of 100% + $5M or 125% + $100k of outgoing salary.</li>
      <li><b>2nd Apron:</b> Can take back no more than sent out, and can't aggregate salaries for matching.</li>
    </ul>
    <span style="color:#b91c1c"><b>Tip:</b> If your trade fails, check if a team is above an apron and the new stricter rules apply!</span>
  </div>
  <div class="trade-controls">
    <button id="addTeamBtn">+ Add Team</button>
    <button id="removeTeamBtn">− Remove Team</button>
  </div>
  <form id="tradeForm" autocomplete="off">
    <div class="trade-container" id="tradeContainer"></div>
    <button type="button" class="trade-btn" id="tryTrade">Propose Trade</button>
  </form>
  <div id="tradeResult"></div>
  <a href="index.html" class="back-home-btn">← Back to Home</a>
  <!-- Trade Result Modal -->
  <div class="modal-overlay" id="tradeModal">
    <div class="trade-modal" role="dialog" aria-modal="true" tabindex="-1">
      <button class="modal-close-btn" id="closeModalBtn" aria-label="Close Modal">&times;</button>
      <div id="modalTitle"></div>
      <div id="modalContent"></div>
    </div>
  </div>
  <script>
    // NBA thresholds
    const SALARY_CAP = 154647000;
    const LUXURY_TAX = 187895000;
    const FIRST_APRON = 195945000;
    const SECOND_APRON = 207824000;
    const maxTeams = 5, minTeams = 2;
    // All rosters, parsed from your images
    const teams = {
      "Atlanta Hawks": [
        { name: "Trae Young", salary: 45999660 },
        { name: "Kristaps Porziņģis", salary: 30731707 },
        { name: "Jalen Johnson", salary: 30000000 },
        { name: "Nickeil Alexander-Walker", salary: 15161800 },
        { name: "Onyeka Okongwu", salary: 15000000 },
        { name: "Zaccharie Risacher", salary: 13197720 },
        { name: "Luke Kennard", salary: 11000000 },
        { name: "Dyson Daniels", salary: 7707709 },
        { name: "Kobe Bufkin", salary: 4503720 },
        { name: "Asa Newell", salary: 3237480 },
        { name: "Vít Krejčí", salary: 2349578 },
        { name: "Caleb Houstan", salary: 2296274 },
        { name: "Mouhamed Gueye", salary: 2221677 },
        { name: "Nikola Đurišić", salary: 1272870 }
      ],
      "Boston Celtics": [
        { name: "Jayson Tatum", salary: 54126450 },
        { name: "Jaylen Brown", salary: 53142264 },
        { name: "Derrick White", salary: 27750700 },
        { name: "Anfernee Simons", salary: 27678571 },
        { name: "Sam Hauser", salary: 10044644 },
        { name: "Georges Niang", salary: 8200000 },
        { name: "Payton Pritchard", salary: 7232143 },
        { name: "Hugo González", salary: 2783880 },
        { name: "Baylor Scheierman", salary: 2619000 },
        { name: "Xavier Tillman", salary: 2546674 },
        { name: "Luka Garza", salary: 2461463 },
        { name: "Josh Minott", salary: 2378870 },
        { name: "Neemias Queta", salary: 2349578 },
        { name: "JD Davison", salary: 2270735 },
        { name: "Jordan Walsh", salary: 2221677 }
      ],
      "Brooklyn Nets": [
        { name: "Michael Porter Jr.", salary: 38333050 },
        { name: "Nicolas Claxton", salary: 25352272 },
        { name: "Terance Mann", salary: 15500000 },
        { name: "Egor Đëmin", salary: 6889200 },
        { name: "Day'Ron Sharpe", salary: 6000000 },
        { name: "Ziaire Williams", salary: 6000000 },
        { name: "Nolan Traoré", salary: 3811560 },
        { name: "Noah Clowney", salary: 3398640 },
        { name: "Dariq Whitehead", salary: 3262560 },
        { name: "Drake Powell", salary: 3372240 },
        { name: "Ben Saraf", salary: 2884560 },
        { name: "Danny Wolf", salary: 2801280 },
        { name: "Keon Johnson", salary: 2349578 },
        { name: "Jalen Wilson", salary: 2221677 },
        { name: "Tyrese Martin", salary: 2191897 },
        { name: "Drew Timme", salary: 1955378 }
      ],
      "Charlotte Hornets": [
        { name: "LaMelo Ball", salary: 37958760 },
        { name: "Miles Bridges", salary: 25000000 },
        { name: "Collin Sexton", salary: 18975000 },
        { name: "Josh Green", salary: 13666666 },
        { name: "Grant Williams", salary: 13645500 },
        { name: "Brandon Miller", salary: 11968800 },
        { name: "Kon Kneuppel", salary: 10015680 },
        { name: "Pat Connaughton", salary: 9423868 },
        { name: "Tre Mann", salary: 8000000 },
        { name: "Tidjane Salaün", salary: 7863240 },
        { name: "Liam McNeeley", salary: 2763960 },
        { name: "DaQuan Jeffries", salary: 2743777 },
        { name: "Nick Smith Jr.", salary: 2710668 },
        { name: "Spencer Dinwiddie", salary: 2296274 },
        { name: "Sion James", salary: 2296274 },
        { name: "Ryan Kalkbrenner", salary: 2296274 },
        { name: "Mason Plumlee", salary: 2296274 },
        { name: "Mousa Diabate", salary: 2270735 }
      ],
      "Chicago Bulls": [
        { name: "Nikola Vučević", salary: 21481481 },
        { name: "Zach Collins", salary: 18080496 },
        { name: "Patrick Williams", salary: 18000000 },
        { name: "Kevin Huerter", salary: 17991071 },
        { name: "Coby White", salary: 12888889 },
        { name: "Isaac Okoro", salary: 11000000 },
        { name: "Jalen Smith", salary: 9000000 },
        { name: "Tre Jones", salary: 8000000 },
        { name: "Ayo Dosunmu", salary: 7518518 },
        { name: "Jevon Carter", salary: 6809524 },
        { name: "Matas Buzelis", salary: 5455560 },
        { name: "Noa Essengue", salary: 5429620 },
        { name: "Dalen Terry", salary: 5399188 },
        { name: "Julian Phillips", salary: 2221677 }
      ],
      "Cleveland Cavaliers": [
        { name: "Donovan Mitchell", salary: 46394100 },
        { name: "Evan Mobley", salary: 46394100 },
        { name: "Darius Garland", salary: 39446090 },
        { name: "DeAndre Hunter", salary: 23303571 },
        { name: "Jarrett Allen", salary: 20000000 },
        { name: "Max Strus", salary: 15936452 },
        { name: "Lonzo Ball", salary: 10000000 },
        { name: "Sam Merrill", salary: 8482144 },
        { name: "Dean Wade", salary: 6623456 },
        { name: "Jaylon Tyson", salary: 3492480 },
        { name: "Larry Nance Jr.", salary: 2296274 },
        { name: "Craig Porter Jr.", salary: 2221677 },
        { name: "Tyrese Proctor", salary: 1272870 }
      ],
      "Dallas Mavericks": [
        { name: "Anthony Davis", salary: 54126450 },
        { name: "Kyrie Irving", salary: 36566002 },
        { name: "Klay Thompson", salary: 16666667 },
        { name: "Daniel Gafford", salary: 14386320 },
        { name: "P.J. Washington", salary: 14152174 },
        { name: "Cooper Flagg", salary: 13825920 },
        { name: "Caleb Martin", salary: 9594044 },
        { name: "Naji Marshall", salary: 9000000 },
        { name: "Max Christie", salary: 7714286 },
        { name: "Jaden Hardy", salary: 6000000 },
        { name: "D'Angelo Russell", salary: 5685000 },
        { name: "Dereck Lively II", salary: 5253360 },
        { name: "Dwight Powell", salary: 4000000 },
        { name: "Olivier-Maxence Prosper", salary: 3007080 },
        { name: "Dante Exum", salary: 2296274 },
        { name: "Brandon Williams", salary: 2270735 }
      ]
    };
    let teamBlocks = [
      { team: "Atlanta Hawks", outgoing: [], incoming: [] },
      { team: "Boston Celtics", outgoing: [], incoming: [] }
    ];
    function salaryFmt(val) {
      return "$" + Number(val).toLocaleString('en-US', {maximumFractionDigits: 0});
    }
    function initials(name) {
      return name
        .split(' ')
        .map(w => w[0])
        .join('')
        .toUpperCase()
        .slice(0,2);
    }
    function payrollBox(players) {
      let total = players.reduce((a,p)=>a+p.salary,0);
      function line(label, threshold) {
        let diff = total - threshold;
        let txt = (diff > 0)
          ? `<span class="over">-${salaryFmt(Math.abs(diff))} over</span>`
          : `<span class="under">${salaryFmt(Math.abs(diff))} under</span>`;
        return `<div class="line"><span class="level">${label}:</span> ${txt}</div>`;
      }
      return `
        <div class="payroll-box">
          <div class="line"><span class="level">Total Payroll</span>: ${salaryFmt(total)}</div>
          ${line("Salary Cap", SALARY_CAP)}
          ${line("Luxury Tax", LUXURY_TAX)}
          ${line("First Apron", FIRST_APRON)}
          ${line("Second Apron", SECOND_APRON)}
        </div>
      `;
    }
    function renderTeams() {
      const ctr = document.getElementById('tradeContainer');
      ctr.innerHTML = '';
      teamBlocks.forEach((block, idx) => {
        const usedTeams = teamBlocks.map(tb => tb.team);
        let teamOpts = '';
        for (let t of Object.keys(teams)) {
          teamOpts += `<option value="${t}" ${block.team === t ? 'selected' : (usedTeams.includes(t) ? 'disabled' : '')}>${t}</option>`;
        }
        const sel = block.outgoing || [];
        let plist = '';
        teams[block.team].forEach((p, pidx) => {
          plist += `
            <li${sel.includes(pidx) ? ' class="selected"' : ''}>
              <input type="checkbox" id="cb${idx}_${pidx}" data-teamidx="${idx}" data-pidx="${pidx}" ${sel.includes(pidx) ? 'checked' : ''}/>
              <span class="player-avatar">${initials(p.name)}</span>
              <label for="cb${idx}_${pidx}">${p.name}</label>
              <span class="salary-cell">${salaryFmt(p.salary)}</span>
            </li>
          `;
        });
        let total = sel.map(pidx => teams[block.team][pidx].salary).reduce((a,b) => a+b, 0);
        let removeBtn = '';
        if (teamBlocks.length > minTeams)
          removeBtn = `<button class="remove-team-btn" title="Remove team" data-remove="${idx}">&times;</button>`;
        ctr.innerHTML += `
          <div class="team-block" data-teamidx="${idx}">
            <div class="team-header">
              <span class="team-label">Team ${idx+1}:</span>
              <select class="teamSel" data-teamidx="${idx}">
                ${teamOpts}
              </select>
              ${removeBtn}
            </div>
            <ul class="players-list">
              ${plist}
            </ul>
            <div class="totals">Outgoing Salary: <span id="outT${idx}">${salaryFmt(total)}</span></div>
            ${payrollBox(teams[block.team])}
          </div>
        `;
      });
      document.querySelectorAll('.teamSel').forEach(sel => {
        sel.onchange = function() {
          const idx = +this.dataset.teamidx;
          if (teamBlocks.map(tb => tb.team).includes(this.value)) return;
          teamBlocks[idx].team = this.value;
          teamBlocks[idx].outgoing = [];
          renderTeams();
        }
      });
      document.querySelectorAll('.players-list input[type=checkbox]').forEach(cb => {
        cb.onchange = function() {
          const tidx = +this.dataset.teamidx, pidx = +this.dataset.pidx;
          let arr = teamBlocks[tidx].outgoing || [];
          if (this.checked) {
            arr.push(pidx);
          } else {
            arr = arr.filter(x => x !== pidx);
          }
          teamBlocks[tidx].outgoing = arr;
          renderTeams();
        }
      });
      document.querySelectorAll('.remove-team-btn').forEach(btn => {
        btn.onclick = function() {
          const idx = +this.dataset.remove;
          teamBlocks.splice(idx, 1);
          renderTeams();
        }
      });
      document.getElementById('removeTeamBtn').disabled = (teamBlocks.length <= minTeams);
      document.getElementById('addTeamBtn').disabled = (teamBlocks.length >= maxTeams);
    }
    renderTeams();
    document.getElementById('addTeamBtn').onclick = function() {
      const used = teamBlocks.map(tb => tb.team);
      const avail = Object.keys(teams).find(t => !used.includes(t));
      if (avail) teamBlocks.push({team: avail, outgoing: [], incoming: []});
      renderTeams();
    };
    document.getElementById('removeTeamBtn').onclick = function() {
      if (teamBlocks.length > minTeams) {
        teamBlocks.pop();
        renderTeams();
      }
    };

    // --- NBA apron-aware trade logic
    document.getElementById('tryTrade').onclick = function() {
      let tradeMap = teamBlocks.map(tb => ({
        team: tb.team,
        outgoingIdx: tb.outgoing,
        outgoing: tb.outgoing.map(idx => teams[tb.team][idx]),
      }));
      if (tradeMap.some(tm => tm.outgoing.length === 0)) {
        showModal('fail', null, 'Each team must trade at least one player.');
        return;
      }
      let teamCount = teamBlocks.length;
      let allSend = teamBlocks.map((tb, i) => tb.outgoing.map(idx => ({...teams[tb.team][idx], from: tb.team, idx})));
      let allPlayers = teamBlocks.map((tb, i) => teams[tb.team]);
      let allTeams = teamBlocks.map(tb => tb.team);
      let payrolls = teamBlocks.map(tb => teams[tb.team].reduce((a, p) => a + p.salary, 0));
      let incoming = [];
      for (let i=0; i<teamCount; ++i) {
        let incArr = [];
        for (let j=0; j<teamCount; ++j) {
          if (i === j) continue;
          incArr.push(...allSend[j]);
        }
        incoming[i] = incArr;
      }
      let tradeOK = true, tradeDetails = [];
      for (let i=0; i<teamCount; ++i) {
        let outgoingSalary = tradeMap[i].outgoing.reduce((a, b) => a + b.salary, 0);
        let incomingSalary = incoming[i].reduce((a, b) => a + b.salary, 0);
        let preTradePayroll = payrolls[i];
        let postTradePayroll = preTradePayroll - outgoingSalary + incomingSalary;

        let stdPlayersOrig = teams[allTeams[i]].length;
        let stdOutgoing = tradeMap[i].outgoing.length;
        let stdIncoming = incoming[i].length;
        let stdAfter = stdPlayersOrig - stdOutgoing + stdIncoming;

        let overFirstApron = preTradePayroll > FIRST_APRON;
        let overSecondApron = preTradePayroll > SECOND_APRON;
        let reasons = [];
        // Minimum roster
        if (stdAfter < 13) {
          tradeOK = false;
          reasons.push('Would leave fewer than 13 standard contracts.');
        }
        // Salary matching: enforce stricter rules if above aprons
        if (overSecondApron) {
          if (incomingSalary > outgoingSalary) {
            tradeOK = false;
            reasons.push(`Above 2nd apron: cannot take back more salary than sent out (incoming: ${salaryFmt(incomingSalary)}, outgoing: ${salaryFmt(outgoingSalary)}).`);
          }
          if (tradeMap[i].outgoing.length > 1 && incoming[i].length > 1) {
            tradeOK = false;
            reasons.push('Above 2nd apron: cannot aggregate salaries from multiple players.');
          }
        } else if (overFirstApron) {
          let max1 = outgoingSalary * 1.25 + 100000;
          let max2 = outgoingSalary + 5000000;
          let maxIncoming = Math.max(max1, max2);
          if (incomingSalary > maxIncoming) {
            tradeOK = false;
            reasons.push(`Above 1st apron: cannot take back more than the greater of 125% + $100k (${salaryFmt(max1)}) or 100% + $5M (${salaryFmt(max2)}).`);
          }
        } else {
          let maxIncoming = outgoingSalary * 1.25 + 250000;
          if (incomingSalary > maxIncoming) {
            tradeOK = false;
            reasons.push(`Cannot take back more than 125% + $250k of outgoing salary (${salaryFmt(maxIncoming)}).`);
          }
        }
        tradeDetails.push({
          team: allTeams[i],
          outgoingSalary, incomingSalary, stdAfter, reasons
        });
      }
      if (!tradeOK) {
        let failMsg = '';
        tradeDetails.forEach(td => {
          if (td.reasons.length)
            failMsg += `<div class="modal-fail-reason"><b>${td.team}:</b> ${td.reasons.join(' ')}</div>`;
        });
        showModal('fail', null, failMsg);
        return;
      }
      // --- Modal: show only trade player movement ---
      let modalContent = '';
      teamBlocks.forEach((tb, i) => {
        if (tradeMap[i].outgoing.length) {
          modalContent += `<div class="modal-team-label">${tb.team} sends:</div><ul class="modal-player-list">`;
          modalContent += tradeMap[i].outgoing.map(p => `<li>${p.name}</li>`).join('');
          modalContent += `</ul>`;
        }
      });
      teamBlocks.forEach((tb, i) => {
        if (incoming[i].length) {
          modalContent += `<div class="modal-team-label">${tb.team} receives:</div><ul class="modal-player-list">`;
          modalContent += incoming[i].map(p => `<li>${p.name} <span style="color:#666;font-size:0.98em;font-weight:400;">(${p.from})</span></li>`).join('');
          modalContent += `</ul>`;
        }
      });
      showModal('success', "Trade Successful!", modalContent);
    };
    function showModal(type, title, content) {
      const modal = document.getElementById('tradeModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalContent');
      modalTitle.innerHTML = type === 'success'
        ? `<div class="modal-title-success">${title || 'Trade Successful!'}</div>`
        : `<div class="modal-title-fail">Trade Failed</div>`;
      modalContent.innerHTML = content;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    document.getElementById('closeModalBtn').onclick = function() {
      document.getElementById('tradeModal').classList.remove('active');
      document.body.style.overflow = '';
    };
    document.getElementById('tradeModal').onclick = function(e) {
      if (e.target === this) {
        this.classList.remove('active');
        document.body.style.overflow = '';
      }
    };
    document.addEventListener('keydown', function(e) {
      if (e.key === "Escape") {
        document.getElementById('tradeModal').classList.remove('active');
        document.body.style.overflow = '';
      }
    });
    // Navbar hamburger JS for mobile
    document.addEventListener("DOMContentLoaded", function() {
      const hamburger = document.querySelector(".hamburger");
      const navRight = document.querySelector(".nav-right");
      const dropdownBtn = document.querySelector(".dropdown-btn");
      const dropdownContent = document.querySelector(".dropdown-content");
      if (hamburger) hamburger.addEventListener("click", function() {
        navRight.classList.toggle("open");
        hamburger.setAttribute("aria-expanded", navRight.classList.contains("open"));
      });
      if (dropdownBtn) dropdownBtn.addEventListener("click", function(e) {
        e.stopPropagation();
        dropdownContent.classList.toggle("show");
        dropdownBtn.setAttribute("aria-expanded", dropdownContent.classList.contains("show"));
      });
      document.addEventListener("click", function(e) {
        if (dropdownBtn && dropdownContent && !dropdownBtn.contains(e.target) && !dropdownContent.contains(e.target)) {
          dropdownContent.classList.remove("show");
          dropdownBtn.setAttribute("aria-expanded", "false");
        }
      });
      document.querySelectorAll(".nav-link, .dropdown-link").forEach(link => {
        link.addEventListener("click", () => {
          navRight.classList.remove("open");
          if (hamburger) hamburger.setAttribute("aria-expanded", "false");
          if (dropdownContent && dropdownBtn) {
            dropdownContent.classList.remove("show");
            dropdownBtn.setAttribute("aria-expanded", "false");
          }
        });
      });
    });
  </script>
</body>
</html>

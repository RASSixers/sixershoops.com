<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>NBA Trade Machine</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #f6f8fa;
      margin: 0;
      color: #23272F;
    }
    h1 {
      background: linear-gradient(90deg,#0a174e 60%,#0057e7 100%);
      color: #fff;
      padding: 2rem 0 1.3rem 0;
      margin: 0 0 1.5rem 0;
      text-align: center;
      font-weight: 800;
      font-size: 2.5rem;
      letter-spacing: 1.2px;
      box-shadow: 0 2px 12px rgba(10,23,78,0.08);
    }
    .trade-controls {
      text-align: center;
      margin: 0 0 2.2rem 0;
    }
    .trade-controls button {
      background: #0057e7;
      color: #fff;
      font-weight: 600;
      font-size: 1.08rem;
      padding: 0.7rem 1.8rem;
      border-radius: 8px;
      border: none;
      margin: 0 0.7rem;
      cursor: pointer;
      transition: background 0.18s;
    }
    .trade-controls button:disabled {
      background: #bbb;
      cursor: not-allowed;
    }
    .trade-container {
      display: flex;
      flex-wrap: wrap;
      gap: 2.5rem;
      justify-content: center;
      margin: 2.5rem 0;
    }
    .team-block {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(10,23,78,0.14);
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      min-width: 320px;
      max-width: 370px;
      flex: 1 1 320px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      margin-bottom: 1rem;
      position: relative;
      transition: box-shadow 0.17s;
    }
    .team-block .remove-team-btn {
      position: absolute;
      top: 14px;
      right: 14px;
      background: none;
      color: #c20000;
      border: none;
      font-size: 1.35rem;
      font-weight: bold;
      cursor: pointer;
      z-index: 2;
      padding: 0 0.2rem;
      transition: color 0.18s;
    }
    .team-block .remove-team-btn:hover {
      color: #e74c3c;
    }
    .team-select label {
      font-weight: 600;
      color: #0057e7;
      margin-right: 0.7rem;
      font-size: 1.08rem;
    }
    .team-select select {
      font-size: 1.08rem;
      padding: 0.35rem 1rem;
      border-radius: 7px;
      border: 1px solid #bbb;
      margin-bottom: 1.2rem;
      margin-top: 0.2rem;
      background: #f6f8fa;
      font-weight: 500;
    }
    .players-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 300px;
      overflow-y: auto;
      border-radius: 6px;
      background: #f8fafc;
      border: 1px solid #f1f1f1;
      box-shadow: 0 2px 6px rgba(10,23,78,0.04);
    }
    .players-list li {
      padding: 0.55rem 0.7rem;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #eee;
      font-size: 1.01rem;
      cursor: pointer;
      transition: background 0.14s;
    }
    .players-list li:last-child { border-bottom: none;}
    .players-list input[type=checkbox] {
      margin-right: 0.7em;
      accent-color: #0057e7;
      cursor: pointer;
    }
    .players-list label {
      flex: 1;
      cursor: pointer;
      font-weight: 500;
    }
    .players-list .salary-cell {
      color: #0057e7;
      min-width: 108px;
      text-align: right;
      font-weight: 600;
      font-size: 1.01rem;
    }
    .players-list .two-way-label {
      color: #c20000;
      font-size: 0.97em;
      font-weight: 600;
      margin-left: 4px;
    }
    .totals {
      margin: 1.1rem 0 0.3rem 0;
      font-weight: 700;
      font-size: 1.1rem;
      color: #333;
      text-align: right;
    }
    .trade-btn {
      margin: 2.4rem auto 1.6rem auto;
      display: block;
      background: #0057e7;
      color: #fff;
      font-size: 1.25rem;
      font-weight: bold;
      border-radius: 13px;
      padding: 1rem 3.2rem;
      border: none;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.18s;
      box-shadow: 0 4px 14px rgba(0,87,231,0.12);
    }
    .trade-btn:hover {
      background: #0a174e;
      box-shadow: 0 8px 28px rgba(0,87,231,0.18);
    }
    .result-block {
      background: #fff;
      border-radius: 12px;
      max-width: 700px;
      margin: 2rem auto;
      box-shadow: 0 4px 16px rgba(10,23,78,0.13);
      padding: 1.5rem 2.5rem;
      font-size: 1.15rem;
      font-weight: 500;
      border-left: 7px solid #eee;
      text-align: left;
    }
    .result-block.success {
      border-left: 7px solid #13a813;
      color: #13a813;
      background: #f3fff4;
    }
    .result-block.fail {
      border-left: 7px solid #c20000;
      color: #c20000;
      background: #fff7f7;
    }
    .result-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.6rem;
      letter-spacing: 0.5px;
    }
    @media (max-width: 1200px) {
      .trade-container { flex-direction: column; align-items: center;}
      .team-block { width: 97vw; max-width: 420px;}
    }
    @media (max-width: 600px) {
      .team-block { padding: 1.1rem 0.6rem; min-width: 0; }
      .result-block { padding: 1.1rem 0.7rem; }
      .trade-btn { padding: 0.7rem 1.2rem; font-size: 1.05rem;}
    }
  </style>
</head>
<body>
  <h1>NBA Trade Machine</h1>
  <div class="trade-controls">
    <button id="addTeamBtn">+ Add Team</button>
    <button id="removeTeamBtn">− Remove Team</button>
  </div>
  <form id="tradeForm" autocomplete="off">
    <div class="trade-container" id="tradeContainer"></div>
    <button type="button" class="trade-btn" id="tryTrade">Propose Trade</button>
  </form>
  <div id="tradeResult"></div>
  <script>
    // --- Modern NBA Trade Machine JS ---
    const maxTeams = 5, minTeams = 2;

    // --- Rosters/Salaries (expand with more teams as needed) ---
    const teams = {
      "Atlanta Hawks": [
        { name: "Trae Young", salary: 45999660 },
        { name: "Kristaps Porziņģis", salary: 30731707 },
        { name: "Jalen Johnson", salary: 30000000 },
        { name: "Nickeil Alexander-Walker", salary: 15161800 },
        { name: "Onyeka Okongwu", salary: 15000000 },
        { name: "Zaccharie Risacher", salary: 13197720 },
        { name: "Luke Kennard", salary: 11000000 },
        { name: "Dyson Daniels", salary: 7707709 },
        { name: "Kobe Bufkin", salary: 4503720 },
        { name: "Asa Newell", salary: 3237480 },
        { name: "Vít Krejčí", salary: 2349578, twoWay: true },
        { name: "Caleb Houstan", salary: 2296274 },
        { name: "Mouhamed Gueye", salary: 2221677, twoWay: true },
        { name: "Nikola Đurišić", salary: 1272870 }
      ],
      "Boston Celtics": [
        { name: "Jayson Tatum", salary: 54126450 },
        { name: "Jaylen Brown", salary: 53142264 },
        { name: "Derrick White", salary: 27750700 },
        { name: "Anfernee Simons", salary: 27678571 },
        { name: "Sam Hauser", salary: 10044644 },
        { name: "Georges Niang", salary: 8200000 },
        { name: "Payton Pritchard", salary: 7232143 },
        { name: "Hugo González", salary: 2783880 },
        { name: "Baylor Scheierman", salary: 2619000 },
        { name: "Xavier Tillman", salary: 2546674 },
        { name: "Luka Garza", salary: 2461463 },
        { name: "Josh Minott", salary: 2378870 },
        { name: "Neemias Queta", salary: 2349578, twoWay: true },
        { name: "JD Davison", salary: 2270735, twoWay: true },
        { name: "Jordan Walsh", salary: 2221677, twoWay: true }
      ],
      "Brooklyn Nets": [
        { name: "Michael Porter Jr.", salary: 38333050 },
        { name: "Nicolas Claxton", salary: 25352272 },
        { name: "Terance Mann", salary: 15500000 },
        { name: "Egor Đëmin", salary: 6889200 },
        { name: "Day'Ron Sharpe", salary: 6000000 },
        { name: "Ziaire Williams", salary: 6000000 },
        { name: "Nolan Traoré", salary: 3811560 },
        { name: "Noah Clowney", salary: 3398640 },
        { name: "Dariq Whitehead", salary: 3262560 },
        { name: "Drake Powell", salary: 3372240 },
        { name: "Ben Saraf", salary: 2884560 },
        { name: "Danny Wolf", salary: 2801280 },
        { name: "Keon Johnson", salary: 2349578, twoWay: true },
        { name: "Jalen Wilson", salary: 2221677, twoWay: true },
        { name: "Tyrese Martin", salary: 2191897, twoWay: true },
        { name: "Drew Timme", salary: 1955378 }
      ]
    };

    // --- Team management state ---
    let teamBlocks = [
      { team: "Atlanta Hawks", outgoing: [], incoming: [] },
      { team: "Boston Celtics", outgoing: [], incoming: [] }
    ];

    // --- Helper: salary formatting ---
    function salaryFmt(val) {
      return val.toLocaleString('en-US', {style:'decimal', maximumFractionDigits:0});
    }

    // --- Rerender all team blocks ---
    function renderTeams() {
      const ctr = document.getElementById('tradeContainer');
      ctr.innerHTML = '';
      teamBlocks.forEach((block, idx) => {
        const usedTeams = teamBlocks.map(tb => tb.team);
        let teamOpts = '';
        for (let t of Object.keys(teams)) {
          teamOpts += `<option value="${t}" ${block.team === t ? 'selected' : (usedTeams.includes(t) ? 'disabled' : '')}>${t}</option>`;
        }
        // Outgoing selected IDs for this team
        const sel = block.outgoing || [];
        // Build players list
        let plist = '';
        teams[block.team].forEach((p, pidx) => {
          plist += `
            <li>
              <input type="checkbox" id="cb${idx}_${pidx}" data-teamidx="${idx}" data-pidx="${pidx}" ${p.twoWay ? 'disabled' : ''} ${sel.includes(pidx) ? 'checked' : ''}/>
              <label for="cb${idx}_${pidx}">${p.name}${p.twoWay ? '<span class="two-way-label">[Two-Way]</span>' : ''}</label>
              <span class="salary-cell">$${salaryFmt(p.salary)}</span>
            </li>
          `;
        });
        // Salary total
        let total = sel.map(pidx => teams[block.team][pidx].salary).reduce((a,b) => a+b, 0);
        // Remove team button if allowed
        let removeBtn = '';
        if (teamBlocks.length > minTeams)
          removeBtn = `<button class="remove-team-btn" title="Remove team" data-remove="${idx}">&times;</button>`;
        ctr.innerHTML += `
          <div class="team-block" data-teamidx="${idx}">
            ${removeBtn}
            <div class="team-select">
              <label>Team ${idx+1}:</label>
              <select class="teamSel" data-teamidx="${idx}">
                ${teamOpts}
              </select>
            </div>
            <ul class="players-list">
              ${plist}
            </ul>
            <div class="totals">Outgoing Salary: $<span id="outT${idx}">${salaryFmt(total)}</span></div>
          </div>
        `;
      });
      // Add listeners for team selection and checkboxes
      document.querySelectorAll('.teamSel').forEach(sel => {
        sel.onchange = function() {
          const idx = +this.dataset.teamidx;
          // Don't allow duplicate teams
          if (teamBlocks.map(tb => tb.team).includes(this.value))
            return;
          teamBlocks[idx].team = this.value;
          teamBlocks[idx].outgoing = [];
          renderTeams();
        }
      });
      document.querySelectorAll('.players-list input[type=checkbox]').forEach(cb => {
        cb.onchange = function() {
          const tidx = +this.dataset.teamidx, pidx = +this.dataset.pidx;
          let arr = teamBlocks[tidx].outgoing || [];
          if (this.checked) {
            arr.push(pidx);
          } else {
            arr = arr.filter(x => x !== pidx);
          }
          teamBlocks[tidx].outgoing = arr;
          renderTeams();
        }
      });
      // Remove team
      document.querySelectorAll('.remove-team-btn').forEach(btn => {
        btn.onclick = function() {
          const idx = +this.dataset.remove;
          teamBlocks.splice(idx, 1);
          renderTeams();
        }
      });
      // Update remove/add team buttons
      document.getElementById('removeTeamBtn').disabled = (teamBlocks.length <= minTeams);
      document.getElementById('addTeamBtn').disabled = (teamBlocks.length >= maxTeams);
    }
    renderTeams();

    // Add/Remove Team buttons
    document.getElementById('addTeamBtn').onclick = function() {
      // Find first unused team
      const used = teamBlocks.map(tb => tb.team);
      const avail = Object.keys(teams).find(t => !used.includes(t));
      if (avail) teamBlocks.push({team: avail, outgoing: [], incoming: []});
      renderTeams();
    };
    document.getElementById('removeTeamBtn').onclick = function() {
      if (teamBlocks.length > minTeams) {
        teamBlocks.pop();
        renderTeams();
      }
    };

    // --- Trade logic ---
    document.getElementById('tryTrade').onclick = function() {
      // Outgoing/incoming
      let tradeMap = teamBlocks.map(tb => ({
        team: tb.team,
        outgoingIdx: tb.outgoing,
        outgoing: tb.outgoing.map(idx => teams[tb.team][idx]),
      }));
      // Validate minimum: must pick at least one outgoing for each team
      if (tradeMap.some(tm => tm.outgoing.length === 0)) {
        showResult('Trade Failed', 'Each team must trade at least one player.', false);
        return;
      }
      // Calculate incoming for each team
      let success = true, failMsg = '';
      let teamCount = teamBlocks.length;
      // Build a matrix: for each team, their incoming is every other team's outgoing
      let allSend = teamBlocks.map((tb, i) => tb.outgoing.map(idx => ({...teams[tb.team][idx], from: tb.team, idx})));
      let allPlayers = teamBlocks.map((tb, i) => teams[tb.team]);
      let allTeams = teamBlocks.map(tb => tb.team);

      // Calculate incoming for each team (players received from all other teams)
      let incoming = [];
      for (let i=0; i<teamCount; ++i) {
        let incArr = [];
        for (let j=0; j<teamCount; ++j) {
          if (i === j) continue;
          // All players outgoing from team j
          incArr.push(...allSend[j]);
        }
        incoming[i] = incArr;
      }

      // CBA SALARY CHECK: (assume all over cap but below apron for simplicity)
      let tradeOK = true, tradeDetails = [];
      for (let i=0; i<teamCount; ++i) {
        let outgoingSalary = tradeMap[i].outgoing.reduce((a, b) => a + b.salary, 0);
        let incomingSalary = incoming[i].reduce((a, b) => a + b.salary, 0);
        // Outgoing salary rule: incoming <= outgoing * 1.25 + 250,000
        let maxIncoming = outgoingSalary * 1.25 + 250000;
        // Roster limit check: team must have at least 13 players after trade (ignore two-way)
        let stdPlayersOrig = teams[allTeams[i]].filter(p => !p.twoWay).length;
        let stdOutgoing = tradeMap[i].outgoing.filter(p => !p.twoWay).length;
        let stdIncoming = incoming[i].filter(p => !p.twoWay).length;
        let stdAfter = stdPlayersOrig - stdOutgoing + stdIncoming;
        let reasons = [];
        if (stdAfter < 13) {
          tradeOK = false;
          reasons.push('Would leave fewer than 13 standard contracts.');
        }
        if (incomingSalary > maxIncoming) {
          tradeOK = false;
          reasons.push(`Incoming salary ($${salaryFmt(incomingSalary)}) exceeds CBA limit ($${salaryFmt(maxIncoming)}).`);
        }
        // No two-way player can be traded
        if (tradeMap[i].outgoing.some(p => p.twoWay)) {
          tradeOK = false;
          reasons.push('Cannot trade two-way players.');
        }
        tradeDetails.push({
          team: allTeams[i],
          outgoingSalary, incomingSalary, maxIncoming, stdAfter, reasons
        });
      }
      // If any reasons, fail message
      if (!tradeOK) {
        let msg = '';
        tradeDetails.forEach(td => {
          if (td.reasons.length)
            msg += `<div><b>${td.team}:</b> ${td.reasons.join(' ')}</div>`;
        });
        showResult('Trade Failed', msg, false);
        return;
      }
      // If all good, show trade result
      let msg = `<div class="result-title">Trade Successful!</div>`;
      teamBlocks.forEach((tb, i) => {
        msg += `<b>${tb.team} trades:</b> ${tradeMap[i].outgoing.map(p => p.name).join(', ')}<br>`;
        msg += `<b>${tb.team} receives:</b> ${incoming[i].map(p => p.name + (p.from ? ` (from ${p.from})` : '')).join(', ') || "(none)"}<br>`;
        msg += `<span style="font-size:0.97em;color:#444;">Incoming salary: $${salaryFmt(incoming[i].reduce((a, b) => a + b.salary, 0))}, Outgoing: $${salaryFmt(tradeMap[i].outgoing.reduce((a, b) => a + b.salary, 0))}</span><br><br>`;
      });
      showResult('Trade Successful!', msg, true);
    };

    function showResult(title, msg, ok) {
      document.getElementById('tradeResult').innerHTML = `
        <div class="result-block ${ok ? 'success' : 'fail'}">
          <div class="result-title">${title}</div>
          ${msg}
        </div>
      `;
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule - Local Development | SixersHoops</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #0f172a;
            color: #fff;
        }
        .server-status {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ef4444;
        }
        .server-status.connected {
            border-left-color: #10b981;
        }
        .instructions {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .instructions h2 {
            margin-top: 0;
            color: #3b82f6;
        }
        .instructions ol {
            line-height: 1.8;
        }
        .instructions code {
            background: #0f172a;
            padding: 2px 6px;
            border-radius: 4px;
            color: #60a5fa;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-success:hover {
            background: #059669;
        }
        iframe {
            width: 100%;
            height: calc(100vh - 300px);
            border: 2px solid #334155;
            border-radius: 8px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="server-status" id="serverStatus">
        <strong>‚ö†Ô∏è Server Status:</strong> <span id="statusText">Checking...</span>
    </div>

    <div class="instructions">
        <h2>üöÄ Local Development Setup</h2>
        <p>To use real NBA.com data locally, follow these steps:</p>
        <ol>
            <li>Double-click <code>start-local-server.bat</code> in the project root folder</li>
            <li>Wait for the message "üöÄ SixersHoops Twitter Proxy Server running on port 3001"</li>
            <li>Click the "Check Server" button below to verify it's running</li>
            <li>Once connected, the schedule will load with real NBA data!</li>
        </ol>
        <p><strong>Note:</strong> Keep the server window open while using the site.</p>
        
        <button class="btn" onclick="checkServer()">Check Server</button>
        <button class="btn btn-success" onclick="testAPI()" id="testBtn" disabled>Test NBA API</button>
        <button class="btn" onclick="location.reload()">Reload Page</button>
    </div>

    <iframe src="schedule.html" id="scheduleFrame"></iframe>

    <script>
        let serverConnected = false;

        async function checkServer() {
            const statusDiv = document.getElementById('serverStatus');
            const statusText = document.getElementById('statusText');
            const testBtn = document.getElementById('testBtn');
            
            statusText.textContent = 'Checking...';
            
            try {
                const response = await fetch('http://localhost:3001/api/health');
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    statusDiv.classList.add('connected');
                    statusText.textContent = '‚úÖ Connected to local server (http://localhost:3001)';
                    testBtn.disabled = false;
                    serverConnected = true;
                    
                    // Update the iframe to use local API
                    updateScheduleToUseLocalAPI();
                } else {
                    throw new Error('Server not healthy');
                }
            } catch (error) {
                statusDiv.classList.remove('connected');
                statusText.textContent = '‚ùå Server not running. Please start start-local-server.bat';
                testBtn.disabled = true;
                serverConnected = false;
            }
        }

        async function testAPI() {
            try {
                const response = await fetch('http://localhost:3001/api/nba-live-game?gameId=0012500010');
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ API Test Successful!\\n\\n' +
                          'Game: ' + data.data.awayTeam.name + ' @ ' + data.data.homeTeam.name + '\\n' +
                          'Score: ' + data.data.awayTeam.score + ' - ' + data.data.homeTeam.score + '\\n' +
                          'Status: ' + data.data.statusText + '\\n\\n' +
                          'Box score data is available!');
                } else {
                    alert('‚ùå API returned an error: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå Failed to fetch from API: ' + error.message);
            }
        }

        function updateScheduleToUseLocalAPI() {
            // Inject script into iframe to override API endpoint
            const iframe = document.getElementById('scheduleFrame');
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const script = iframeDoc.createElement('script');
                    script.textContent = `
                        // Override the fetchLiveGameData function to use local server
                        const originalFetch = window.fetch;
                        window.fetch = function(url, options) {
                            if (url.includes('/api/nba-live-game')) {
                                // Replace with local server URL
                                url = url.replace('/api/nba-live-game', 'http://localhost:3001/api/nba-live-game');
                            }
                            return originalFetch(url, options);
                        };
                        console.log('‚úÖ Local API override active - using http://localhost:3001');
                    `;
                    iframeDoc.head.appendChild(script);
                } catch (e) {
                    console.error('Could not inject script into iframe:', e);
                }
            };
        }

        // Check server status on load
        checkServer();
        
        // Auto-check every 5 seconds
        setInterval(checkServer, 5000);
    </script>
</body>
</html>
